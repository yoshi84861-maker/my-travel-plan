<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„æ—…éŠè¨ˆç•« âœˆï¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen p-4">
    <div class="max-w-xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden p-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
            ğŸ“ æ—…éŠè¡Œç¨‹è¦åŠƒåŠ©æ‰‹
        </h1>

        <div class="space-y-3 bg-blue-50 p-4 rounded-xl mb-6">
            <div class="grid grid-cols-2 gap-2">
                <input id="city" type="text" placeholder="åŸå¸‚ (è‹±æ–‡, å¦‚: Tokyo)" class="p-2 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
                <input id="date" type="date" class="p-2 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
            </div>
            <textarea id="activity" placeholder="é€™å¤©æƒ³å»å“ªè£¡ç©ï¼Ÿ" class="w-full p-2 border rounded-lg h-20 outline-none focus:ring-2 focus:ring-blue-400"></textarea>
            <button onclick="addTrip()" class="w-full bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 transition">
                â• åŠ å…¥è¡Œç¨‹
            </button>
        </div>

        <div id="tripList" class="space-y-4">
            </div>
        
        <div class="mt-8 border-t pt-4 flex justify-between text-sm text-gray-400">
            <span>è³‡æ–™å„²å­˜æ–¼æœ¬åœ°ç€è¦½å™¨</span>
            <button onclick="exportData()" class="text-blue-500 hover:underline">åŒ¯å‡ºè¡Œç¨‹æª”æ¡ˆ</button>
        </div>
    </div>

    <script>
        const API_KEY = '2f6396d64af0f2086c95718c08352936E'; // é€™è£¡å¡«å…¥ä½ çš„ OpenWeatherMap API Key

        let trips = JSON.parse(localStorage.getItem('myTrips')) || [];

        async function fetchWeather(city) {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric&lang=zh_tw`);
                const data = await response.json();
                if (data.cod !== 200) return "æŸ¥ç„¡å¤©æ°£";
                return `${data.main.temp}Â°C ${data.weather[0].description}`;
            } catch {
                return "é€£ç·šå¤±æ•—";
            }
        }

        async function addTrip() {
            const city = document.getElementById('city').value;
            const date = document.getElementById('date').value;
            const activity = document.getElementById('activity').value;

            if (!city || !date) return alert("è«‹å¡«å¯«åŸå¸‚èˆ‡æ—¥æœŸï¼");

            const weather = await fetchWeather(city);
            const newTrip = { id: Date.now(), city, date, activity, weather };
            
            trips.push(newTrip);
            saveAndRender();
            
            // æ¸…ç©ºè¼¸å…¥
            document.getElementById('activity').value = '';
        }

        function deleteTrip(id) {
            trips = trips.filter(t => t.id !== id);
            saveAndRender();
        }

        function saveAndRender() {
            localStorage.setItem('myTrips', JSON.stringify(trips));
            render();
        }

        function render() {
            const list = document.getElementById('tripList');
            // æŒ‰æ—¥æœŸæ’åº
            trips.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            list.innerHTML = trips.map(t => `
                <div class="border rounded-xl p-4 relative group hover:border-blue-300 transition shadow-sm">
                    <button onclick="deleteTrip(${t.id})" class="absolute top-2 right-2 text-gray-300 hover:text-red-500">âœ•</button>
                    <div class="flex justify-between items-start">
                        <div>
                            <span class="text-sm font-bold text-blue-500">${t.date}</span>
                            <h3 class="text-lg font-bold text-gray-700">${t.city}</h3>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-400 block text-nowrap">é ä¼°å¤©æ°£</span>
                            <span class="text-sm font-medium text-orange-500">${t.weather}</span>
                        </div>
                    </div>
                    <p class="text-gray-600 mt-2 text-sm whitespace-pre-line">${t.activity}</p>
                </div>
            `).join('');
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(trips));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "my_travel_plan.json");
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        render(); // åˆå§‹è¼‰å…¥
    </script>
</body>
</html>
